name: Deploy to Lolipop
on:
  push:
    branches:
      - main
jobs:
  web-deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
    - name: Get latest code
      uses: actions/checkout@v4
    
    - name: Install LFTP
      run: sudo apt-get update && sudo apt-get install -y lftp

    - name: Deploy via LFTP
      run: |
        lftp -c "
        set ftp:ssl-allow no;
        set ssl:verify-certificate no;
        open -u '${{ secrets.FTP_USERNAME }}','${{ secrets.FTP_PASSWORD }}' '${{ secrets.FTP_SERVER }}';
        ls -la;
        mkdir -p -f katayama-website;
        mirror -R -v --parallel=2 \
        --exclude-glob .git*/ \
        --exclude-glob .github/ \
        --exclude-glob .env* \
        --exclude-glob node_modules/ \
        --exclude-glob .tools/ \
        --exclude-glob .trae/ \
        --exclude-glob .vercel/ \
        --exclude-glob supabase/ \
        --exclude-glob scripts/ \
        --exclude-glob cms/ \
        --exclude-glob generate-password.php \
        --exclude-glob MCP-SETUP.md \
        --exclude-glob DEPLOYMENT-GUIDE.md \
        --exclude-glob setup-guide.md \
        --exclude-glob SUPABASE-SETUP-GUIDE.md \
        --exclude-glob package.json \
        --exclude-glob 'Trend Company.svg' \
        --exclude-glob config/supabase.secrets.php \
        --exclude-glob debug-api.php \
        --exclude-glob test-api.php \
        --exclude-glob test-local.html \
        --exclude-glob test-site-settings.html \
        --exclude-glob admin/api/debug-supabase.php \
        --exclude-glob admin/api/test-connection.php \
        --exclude-glob admin/api/test-update.php \
        --exclude-glob admin/tools/reseed.php \
        --exclude-glob seed-supabase.php \
        ./ katayama-website"
