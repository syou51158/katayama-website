<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ローカルテスト - 片山建設工業</title>
    <link rel="stylesheet" href="assets/css/build.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ローカル環境テスト</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">APIテスト結果</h2>
            <div id="test-results">
                <p class="text-gray-500">テスト実行中...</p>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">デバッグ情報</h2>
            <div id="debug-info">
                <p class="text-gray-500">読み込み中...</p>
            </div>
        </div>
    </div>

    <script>
        async function runTests() {
            const resultsDiv = document.getElementById('test-results');
            const debugDiv = document.getElementById('debug-info');
            
            // デバッグ情報を表示
            debugDiv.innerHTML = `
                <ul class="space-y-2 text-sm">
                    <li><strong>現在のURL:</strong> ${window.location.href}</li>
                    <li><strong>ベースURL:</strong> ${window.location.origin}</li>
                    <li><strong>パス:</strong> ${window.location.pathname}</li>
                    <li><strong>プロトコル:</strong> ${window.location.protocol}</li>
                </ul>
            `;
            
            let results = '<div class="space-y-4">';
            
            // テストするAPIパス
            const apiPaths = [
                'api/supabase-news.php',
                '/katayama-website/api/supabase-news.php',
                './api/supabase-news.php',
                '../api/supabase-news.php',
                'debug-api.php',
                '/katayama-website/debug-api.php'
            ];
            
            for (const path of apiPaths) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(path);
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        results += `
                            <div class="border border-green-300 bg-green-50 p-3 rounded">
                                <strong class="text-green-800">✅ ${path}</strong>
                                <br><small class="text-green-600">
                                    ステータス: ${response.status} | 
                                    レスポンス時間: ${responseTime}ms |
                                    データ: ${Array.isArray(data) ? data.length + '件' : typeof data}
                                </small>
                            </div>
                        `;
                    } else {
                        results += `
                            <div class="border border-yellow-300 bg-yellow-50 p-3 rounded">
                                <strong class="text-yellow-800">⚠️ ${path}</strong>
                                <br><small class="text-yellow-600">
                                    ステータス: ${response.status} ${response.statusText}
                                </small>
                            </div>
                        `;
                    }
                } catch (error) {
                    results += `
                        <div class="border border-red-300 bg-red-50 p-3 rounded">
                            <strong class="text-red-800">❌ ${path}</strong>
                            <br><small class="text-red-600">
                                エラー: ${error.message}
                            </small>
                        </div>
                    `;
                }
            }
            
            results += '</div>';
            resultsDiv.innerHTML = results;
        }
        
        // ページ読み込み後にテスト実行
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>

